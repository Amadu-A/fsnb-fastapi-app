{% extends "core/base.html" %}
{% block title %}Admin — Edit User{% endblock %}

{% block content %}
  <h2>Редактирование пользователя #{{ user.id }}</h2>

  <form method="post" action="{{ request.url_for('admin_user_edit_post', user_id=user.id) }}" class="card">
    <input type="hidden" name="csrf_token" value="{{ csrf }}">

    <h3>Учётная запись</h3>
    <div class="form-row">
      <label>Username</label>
      <input type="text" name="username" value="{{ user.username or '' }}">
    </div>
    <div class="form-row">
      <label>Активен</label>
      <input type="checkbox" name="is_active" {% if user.is_active %}checked{% endif %}>
    </div>

    <h3>Профиль</h3>
    <div class="form-row">
      <label>Nickname</label>
      <input type="text" name="nickname" value="{{ profile.nickname or '' }}">
    </div>
    <div class="form-row">
      <label>Имя</label>
      <input type="text" name="first_name" value="{{ profile.first_name or '' }}">
    </div>
    <div class="form-row">
      <label>Фамилия</label>
      <input type="text" name="second_name" value="{{ profile.second_name or '' }}">
    </div>
    <div class="form-row">
      <label>Телефон</label>
      <input type="text" name="phone" value="{{ profile.phone or '' }}">
    </div>
    <div class="form-row">
      <label>E-mail (в профиле)</label>
      <input type="text" name="email" value="{{ profile.email or '' }}">
    </div>
    <div class="form-row">
      <label>Telegram ID</label>
      <input type="text" name="tg_id" value="{{ profile.tg_id or '' }}">
    </div>
    <div class="form-row">
      <label>Telegram nickname</label>
      <input type="text" name="tg_nickname" value="{{ profile.tg_nickname or '' }}">
    </div>
    <div class="form-row">
      <label>Подтверждён</label>
      <input type="checkbox" name="verification" {% if profile.verification %}checked{% endif %}>
    </div>

    <h3>Права</h3>
    {% if perm_note %}
      <div class="alert alert-error">{{ perm_note }}</div>
    {% endif %}
    <div class="grid-2">
      <label>
        <input type="checkbox" name="is_superadmin"
               {% if perm.is_superadmin %}checked{% endif %}
               {% if not can_edit_super_flag or not perm_editable %}disabled{% endif %}>
        is_superadmin
      </label>

      <label>
        <input type="checkbox" name="is_admin_flag"
               {% if perm.is_admin %}checked{% endif %}
               {% if not perm_editable %}disabled{% endif %}>
        is_admin
      </label>

      <label>
        <input type="checkbox" name="is_staff"
               {% if perm.is_staff %}checked{% endif %}
               {% if not perm_editable %}disabled{% endif %}>
        is_staff
      </label>

      <label>
        <input type="checkbox" name="is_updater"
               {% if perm.is_updater %}checked{% endif %}
               {% if not perm_editable %}disabled{% endif %}>
        is_updater
      </label>

      <label>
        <input type="checkbox" name="is_reader"
               {% if perm.is_reader %}checked{% endif %}
               {% if not perm_editable %}disabled{% endif %}>
        is_reader
      </label>

      <label>
        <input type="checkbox" name="is_user_flag"
               {% if perm.is_user %}checked{% endif %}
               {% if not perm_editable %}disabled{% endif %}>
        is_user
      </label>
    </div>

    <div style="margin-top:16px">
      <button type="submit" class="btn btn-primary">Сохранить</button>
      <a class="btn" href="{{ request.url_for('admin_users') }}">Назад к списку</a>
    </div>
  </form>
{% endblock %}
