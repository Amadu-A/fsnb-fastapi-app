<!-- path: templates/admin/model_edit.html -->
{% extends "core/base.html" %}
{% block content %}
  <h1 class="title">Редактирование: {{ model_name }} #{{ obj.id }}</h1>

  <form class="form form--wide" method="post"
        action="{{ request.url_for('admin_model_edit_post', slug=slug, obj_id=obj.id) }}">
    <input type="hidden" name="csrf_token" value="{{ csrf }}"/>

    {% for name in fields %}
      {% set label = labels.get(name, name) %}
      {% set val = attr(obj, name) %}
      <div class="form__row">
        <label class="form__label">{{ label }}</label>

        <div class="form__control">
          {% if name in readonly_fields %}
            <div class="admin__readonly">
              {% if fk_map.get(name) and val %}
                <a href="{{ request.url_for('admin_model_list', slug=fk_map[name]['slug']) }}?{{ fk_map[name]['field'] }}={{ val }}">{{ val }}</a>
              {% else %}
                {{ val }}
              {% endif %}
            </div>
          {% else %}
            {% if name.startswith("is_") and (val is boolean or val in [True, False, 0, 1, '0', '1']) %}
              <label class="admin__check">
                <input type="checkbox" name="{{ name }}" {% if val == True %}checked{% endif %}>
                <span>{{ name }}</span>
              </label>
            {% else %}
              <input class="form__input" type="text" name="{{ name }}" value="{{ val if val is not none else '' }}">

              {% if fk_map.get(name) and val %}
                <div class="admin__fk-link">
                  <a href="{{ request.url_for('admin_model_list', slug=fk_map[name]['slug']) }}?{{ fk_map[name]['field'] }}={{ val }}">
                    Открыть связанную запись ({{ fk_map[name]['slug'] }}: {{ val }})
                  </a>
                </div>
              {% endif %}
            {% endif %}
          {% endif %}
        </div>
      </div>
    {% endfor %}

    <div class="form__actions admin__actions">
      <button type="submit" class="btn btn--primary">Сохранить</button>
      <a href="{{ request.url_for('admin_model_list', slug=slug) }}" class="btn">Назад</a>
    </div>
  </form>
{% endblock %}
